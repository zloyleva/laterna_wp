!function(c){"use strict";if("undefined"!=typeof WPGlobusWidgets){var f={saveArbitraryTextOrHTML:!1,editor:{},languageBoxActive:!1,languageBoxTimeout:null,init:function(){f.addElements(),f.attachListeners(),f.arbitraryTextOrHTML()},wysiwygClean:function(){c(".wpglobus-dialog-field").each(function(e,t){var i=c(t).data("source-id");if(1==c("#"+i+"-tmce").size()){var a=c(t).next(".wpglobus_dialog_start");c(t).remove(),c(a).remove()}})},setupWidgetControl:function(a,e,i){var o=!1;if(c.each(f.editor,function(e,t){if(t.widgetName==a)return!(o=!0)}),!o){var n=e.$el[0].id;if(""==n){var t=e.$el[0].offsetParent;void 0===(n=c(t).attr("id"))&&c(".widget").each(function(e,t){var i=c(t).attr("id");if(-1!=i.indexOf(a))return n=i,!1})}var r="#"+n+" #widget-"+a+"-text",d="#"+n+" #widget-"+a+"-title";f.editor[i.id]={},f.editor[i.id].widgetName=a,f.editor[i.id].controls=e,f.editor[i.id].sourceTitleSelector=d,f.editor[i.id].titleSelector=null,f.editor[i.id].sourceSelector=r,f.editor[i.id].content=c(r).val(),f.editor[i.id].saveSelector="#"+n+" #widget-"+a+"-savewidget",f.editor[i.id].languageSelector="#"+n+" .wpglobus-current-language",f.editor[i.id].inWidgetTitleSelector="#"+n+" .in-widget-title";var l=WPGlobusCore.TextFilter(f.editor[i.id].content,WPGlobusCoreData.default_language,"RETURN_EMPTY");c("#"+i.id).val(l);var u="",s="";c.each(WPGlobusCoreData.enabled_languages,function(e,t){u=(u=(u=(u=(u=(u=(u='<a href="#" onclick="return false;" class="item" data-widget-id="{{widgetID}}" data-source="{{source}}" data-editor-id="{{editorID}}" data-language="{{language}}" data-widget-name="{{widgetName}}" style="text-align:center;"><span>{{item}}</span></a>').replace("{{language}}",t)).replace("{{item}}",WPGlobusCoreData.en_language_name[t])).replace("{{widgetName}}",a)).replace("{{widgetID}}",n)).replace("{{editorID}}",i.id)).replace("{{source}}",r),s+=u});var g='<button style="z-index:200000;" type="button" id="'+i.id+'-wpglobus-button" data-widget-id="'+n+'"class="wp-switch-editor switch-wpglobus-language wpglobus-icon-globe"><span class="wpglobus-current-language" data-language="en" style="">En</span></button><div class="wpglobus-language-box" style="position:absolute;top:0;left:0;display:none;z-index:200100;border:1px solid #9e9e9e;border-radius:3px;background-color:#fff;padding: 2px 5px;"><div style="display:flex;flex-direction:column;">'+s+"</div></div>";c("#"+n+" .wp-editor-tabs").append(g),WPGlobusDialogApp.addElement({id:e.fields.title[0].id,style:"width:93%;"})&&(f.editor[i.id].titleSelector="#"+e.fields.title[0].id),f.arbitraryWidgetTitle(i.id)}},arbitraryWidgetTitle:function(e){var t=WPGlobusCore.TextFilter(c("#"+f.editor[e].controls.fields.title[0].id).val(),WPGlobusCoreData.language);c(f.editor[e].inWidgetTitleSelector).text(": "+t)},setBoxTimeout:function(){f.languageBoxTimeout=setTimeout(function(){f.languageBoxActive=!1,c(".wpglobus-language-box").css({display:"none"})},1e3)},arbitraryTextOrHTML:function(){function i(e){var t="";if(t="keyup"==e.type&&"tinymce"==e.target.id?c(e.target).data("id"):e.target.id,f.editor[t]){var i=c(f.editor[t].languageSelector).data("language"),a="";a=tinymce.get(t).isHidden()?c("#"+t).val():tinymce.get(t).getContent({format:"raw"}),f.editor[t].content=WPGlobusCore.getString(f.editor[t].content,a,i),c(f.editor[t].sourceSelector).val(f.editor[t].content)}}c(document).on("click",".switch-wpglobus-language",function(e){if(!f.languageBoxActive){f.languageBoxActive=!0;var t=c(this),i=t.data("widget-id"),a=t.position();a.top+=34,a.left+=10,c("#"+i+" .wpglobus-language-box").css({display:"block",top:a.top+"px",left:a.left+"px"}),f.setBoxTimeout()}}),c(document).on("mouseenter",".wpglobus-language-box",function(e){clearTimeout(f.languageBoxTimeout)}).on("mouseleave",".wpglobus-language-box",function(e){c(".wpglobus-language-box").css({display:"none"}),f.languageBoxActive=!1}),c(document).on("click",".wpglobus-language-box .item",function(e){var t=c(this),i=t.data("language"),a=t.data("widget-id"),o=t.data("editor-id");c("#"+a+" .wpglobus-current-language").text(i).data("language",i);var n=WPGlobusCore.TextFilter(f.editor[o].content,i,"RETURN_EMPTY");tinymce.get(o).setContent(n,{format:"raw"}),c("textarea#"+o).val(n)}),c(document).on("tinymce-editor-setup",function(e,i){c.each(wp.textWidgets.widgetControls,function(e,t){f.setupWidgetControl(e,t,i)})}),c(document).on("tinymce-editor-init",function(e,t){c(document).on("mouseenter",f.editor[t.id].saveSelector,function(e){c(f.editor[t.id].sourceTitleSelector).val(c(f.editor[t.id].titleSelector).val()),c(f.editor[t.id].sourceSelector).val(f.editor[t.id].content)}),c(document).on("click",f.editor[t.id].saveSelector,function(e){f.saveArbitraryTextOrHTML=t.id}),t.on("nodechange keyup",_.debounce(i,100)),c("#"+t.id).on("keyup",_.debounce(i,100))})},addElements:function(e,t){var i,a=[];a[0]='input[type="text"]',a[1]="textarea",void 0===e||"class"==e?(i=".widget-liquid-right .widget .widget-content",c.each(a,function(e,t){f.makeClone(i,t)})):"id"==e&&(i="#"+t+" .widget-content",c.each(a,function(e,t){f.makeClone(i,t)}))},makeClone:function(e,u){c(e+" "+u).each(function(e,t){var i,a,o,n,r=c(t),d=!1;if(void 0===(n=r.attr("id"))||-1!=n.indexOf("-number")||""==n)return!0;if(_.each(WPGlobusWidgets.disabledMask,function(e){if(-1!=n.indexOf(e))return!(d=!0)}),d)return!0;if(i=c("#"+n).clone(),c(r).addClass("wpglobus-dialog-field-source hidden"),a=r.attr("name"),c(i).attr("id","wpglobus-"+n),c(i).attr("name","wpglobus-"+a),c(i).attr("data-source-id",n),c(i).attr("class","wpglobus-dialog-field"),c(i).attr("style","width:90%;"),o=WPGlobusCore.TextFilter(c(r).val(),WPGlobusCoreData.language),c(i).val(o),c('<div style="width:20px;" data-type="control" data-source-type="" data-source-id="'+n+'" class="wpglobus-widgets wpglobus_dialog_start wpglobus_dialog_icon"></div>').insertAfter(r),c(i).insertAfter(r),'input[type="text"]'==u&&""!=o){var l=r.parents(".widget").attr("id");c("#"+l+" .in-widget-title").text(": "+o)}})},attachListeners:function(){c(document).ajaxComplete(function(e,t,i){if(-1!=i.data.indexOf("action=save-widget"))if(-1!=i.data.indexOf("delete_widget=1"));else{if(f.saveArbitraryTextOrHTML){var a=WPGlobusCore.TextFilter(f.editor[f.saveArbitraryTextOrHTML].content,c(f.editor[f.saveArbitraryTextOrHTML].languageSelector).data("language"),"RETURN_EMPTY");return tinymce.get(f.saveArbitraryTextOrHTML).isHidden()?(c("#"+f.saveArbitraryTextOrHTML).val(a),c("#"+f.saveArbitraryTextOrHTML+"-tmce").click()):tinymce.get(f.saveArbitraryTextOrHTML).setContent(a,{format:"raw"}),f.arbitraryWidgetTitle(f.saveArbitraryTextOrHTML),void(f.saveArbitraryTextOrHTML=!1)}var o=i.data.split("widget-id=");o=o[1].split("&"),c(".widget-liquid-right .widget").each(function(e,t){var i=c(t).attr("id");-1!==i.indexOf(o[0])&&(f.addElements("id",i),f.wysiwygClean())})}}),c("body").on("change",".wpglobus-dialog-field",function(){var i,a,o=c(this),e="#"+o.data("source-id"),n="";void 0!==e&&(i=c(e).val(),/(\{:|\[:|<!--:)[a-z]{2}/.test(i)?(c.each(WPGlobusCoreData.enabled_languages,function(e,t){""!=(a=t==WPGlobusCoreData.language?o.val():WPGlobusCore.TextFilter(i,t,"RETURN_EMPTY"))&&(n+=WPGlobusCore.addLocaleMarks(a,t))}),c(e).val(n)):c(e).val(o.val()))}),c(document).on("click",".widget-title, .widget-title-action",function(e){e.preventDefault(),f.wysiwygClean(),f.imageWidget(this)})},imageWidget:function(e){var t=c(e).parents(".widget").attr("id");if(-1!=t.indexOf("media_image")){var i=c("#"+t+" .in-widget-title"),a=c("#"+t).find('input[type="text"]').attr("id");if(-1!=a.indexOf(".")){var o="wpg-"+a.replace(".","_");if(c("#"+t).find('input[type="text"]').attr("name",o),WPGlobusDialogApp.addElement(o)){var n=c("#"+t).find('input[name="'+o+'"]'),r=WPGlobusCore.getTranslations(n.val())[WPGlobusCoreData.language];i.text(": "+r),setTimeout(function(){c("#wpglobus-"+o).val(r)},1e3)}}else if(WPGlobusDialogApp.addElement(a)){r=WPGlobusCore.getTranslations(c("#"+a).val())[WPGlobusCoreData.language];i.text(": "+r),setTimeout(function(){c("#wpglobus-"+a).val(r)},1e3)}}}};WPGlobusWidgets=c.extend({},WPGlobusWidgets,f)}}(jQuery);