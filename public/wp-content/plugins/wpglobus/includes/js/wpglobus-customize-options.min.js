jQuery(document).ready(function(c){"use strict";var u={listID:"#wpglobus-sortable",customizeSave:!1,customizeSaveData:"",init:function(){c("#wpglobus-sortable").sortable({update:u.sortUpdate}),u.setJSCodeSection(),u.addListeners(),u.ajaxListener()},setJSCodeSection:function(){var e=WPGlobusCustomizeOptions.settings.wpglobus_js_editor_section;void 0!==e&&void 0!==e.wpglobus_customize_js_editor&&(c("#customize-control-wpglobus_customize_js_editor .customize-control-title").css({width:"50%"}).after('<span class="wpglobus-customize-js-editor-expand" style="float:right;"><a href="#">'+WPGlobusCustomizeOptions.i18n.expandShrink+"</a></span>"),c(document).on("click",".wpglobus-customize-js-editor-expand",function(e){var o=c(this),t=c("#customize-controls");o.toggleClass("expanded"),o.hasClass("expanded")?t.css({width:"500px"}):t.css({width:""})}),c("#sub-accordion-section-wpglobus_js_editor_section .customize-section-back").on("click",function(e){c("#customize-controls").css({width:""}),c(".wpglobus-customize-js-editor-expand").removeClass("expanded")}))},addListeners:function(){c("body").on("change",".wpglobus-listen-change",function(e){u.setState(!1)}),c("body").on("change","#wpglobus-sortable input.wpglobus-language-item",function(e){var o=c(this);o.prop("checked")||u.removeLanguage(o)}),c("#customize-control-wpglobus_add_languages_select_box select").on("change",function(e){u.addLanguage(e,this)}),c("#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title").off("click keydown"),c("body").on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title",function(e){window.open(WPGlobusCustomizeOptions.addonsPage,"_blank")}),c(document).on("click","#"+WPGlobusCustomizeOptions.userControlSaveButton,function(){u.userControlAjax(this)}),c(document).on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_js_editor_section+" .accordion-section-title",function(e){c("#customize-control-wpglobus_customize_js_editor .CodeMirror").css({height:"40em"})})},removeLanguage:function(e){var o=e.data("language"),t=c("#customize-control-wpglobus_add_languages_select_box select option").eq(0);c('<option value="'+o+'">'+WPGlobusCustomizeOptions.config.language_name[o]+" ("+WPGlobusCustomizeOptions.config.en_language_name[o]+") </option>").insertAfter(t),e.parent("li").remove()},addLanguage:function(e,o){var t=c(o).attr("value"),s=c("#wpglobus-item-skeleton").html(),n="",i=c(u.listID+" li").attr("class");if("select"!=t){n=(n=(n=(n=(n=(n=(n=(n=(n=s.replace("{{flag}}",'src="'+WPGlobusCustomizeOptions.config.flags_url+WPGlobusCustomizeOptions.config.flag[t]+'"')).replace("{{name}}",t)).replace("{{id}}",t)).replace('checked="{{checked}}"','checked="checked"')).replace('disabled="{{disabled}}"',"")).replace("{{item}}",WPGlobusCustomizeOptions.config.en_language_name[t]+" ("+t+") ")).replace("{{order}}","#")).replace("{{language}}",t)).replace("{{edit-link}}",WPGlobusCustomizeOptions.editLink.replace("{{language}}",t)),c('<li class="'+i+'">'+n+"</li>").appendTo(u.listID),u.setOrder();var a=c(o).find("option");c.each(a,function(e,o){c(o).attr("value")==t&&c(o).remove()})}},sortUpdate:function(e,o){u.setState(!1),u.setOrder()},setOrder:function(){c("#wpglobus-sortable input.wpglobus-language-item").each(function(e,o){var t=c(o);0==e?t.prop("disabled","disabled").prop("checked","checked"):t.removeProp("disabled"),t.data("order",e)})},setState:function(e){wp.customize.state("saved").set(e)},getCustomizeSaveData:function(){return u.customizeSaveData},enabledUserControl:function(e){return void 0!==WPGlobusCustomize.controlInstances[e]&&WPGlobusCustomize.controlInstances[e].userControl.enabled},userControlAjax:function(e){c(e).prop("disabled",!0);var n={action:"cb-controls-save",controls:{}};c(".wpglobus-customize-cb-control").each(function(e,o){var t=c(o);if(t.prop("checked"));else{var s=t.data("control");s=(s=s.replace("[","{{")).replace("]","}}"),n.controls[s]="disable"}}),c.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:n},dataType:"json"}).always(function(){location.reload(!0)})},ajax:function(e,o){if("wpglobus_customize_save"==e){var i={action:"wpglobus_customize_save",options:{}};c.each(WPGlobusCustomizeOptions.settings,function(e,o){c.each(o,function(e,t){if("wpglobus_customize_enabled_languages"==e)return i.options[t.option]={},c("#wpglobus-sortable input.wpglobus-language-item").each(function(e,o){i.options[t.option][c(this).data("language")]="1"}),!0;if(-1!=u.customizeSaveData.indexOf("wpglobus_customize_post_type_")&&-1!=e.indexOf("wpglobus_customize_post_type_"))void 0===i.options[t.option]&&(i.options[t.option]={}),i.options[t.option][e.replace("wpglobus_customize_post_type_","")]=c("#customize-control-"+e+" input").prop("checked")?1:0;else if(-1!=u.customizeSaveData.indexOf(e)){var o=c("#customize-control-"+e+" "+t.type),s="";if("textarea"==t.type)s=o.val();else if("wpglobus_checkbox"==t.type)o=c("#customize-control-"+e+" input"),s="wpglobus_customize_selector_wp_list_pages"==e?o.prop("checked")?1:0:o.prop("checked")?1:"";else if("checkbox"==t.type)s=o.prop("checked")?1:"";else if("select"==t.type)s=o.val();else if("code_editor"==t.type){var n=wp.customize.control.instance(e);void 0!==n&&(s=n.setting())}i.options[t.option]=s,"code_editor"==t.type&&void 0===n&&delete i.options[t.option]}})})}c.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:i},dataType:"json"})},getChangesetData:function(e){if(void 0!==e){var o=/customize_changeset_data=([^&]+)/.exec(e);if(void 0===o[1])return;var t,s=decodeURIComponent(o[1]),n=JSON.parse(s);c.each(n,function(e,o){void 0!==WPGlobusCustomize.controlInstances[e]&&(t="",t=(WPGlobusCustomize.controlInstances[e].type,WPGlobusCustomize.controlInstances[e].setting),n[e].value=t)});var i=JSON.stringify(n);i=(i=encodeURIComponent(i)).replace(/%20/g,"+"),e=e.replace(o[1],i)}return e},ajaxListener:function(){c(document).on("ajaxSend",function(e,o,t){void 0!==t.data&&-1!=t.data.indexOf("wp_customize=on")&&-1!=t.data.indexOf("action=customize_save")&&(-1!=t.data.indexOf("customized=")?(u.customizeSave=!0,u.customizeSaveData=t.data):-1!=t.data.indexOf("customize_changeset_data=")&&(t.data=u.getChangesetData(t.data)))}),c(document).on("ajaxComplete",function(e,o,t){void 0!==o.responseText&&u.customizeSave&&(u.customizeSave=!1,u.ajax("wpglobus_customize_save"))}),c(document).on("ajaxStop",function(){u.customizeSave&&(u.customizeSave=!1,u.ajax("wpglobus_customize_save"))})}};WPGlobusCustomizeOptions=c.extend({},WPGlobusCustomizeOptions,u),WPGlobusCustomizeOptions.init()});